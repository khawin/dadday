<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>สุขสันต์วันปะป๊า</title>
    
    <!-- Google Fonts: Kanit & Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --primary-yellow: #FCD34D;
            --soft-yellow: #FEF9C3;
            --text-brown: #78350F;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: #FFFBEB;
            /* Polka dot pattern */
            background-image: radial-gradient(#FDE68A 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            color: var(--text-brown);
            overflow: hidden; /* Prevent body scroll, handle in container */
            height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            height: 100dvh;
            background: rgba(255, 251, 235, 0.95); /* Slight glass effect */
            backdrop-filter: blur(5px);
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Floating Background Elements --- */
        .bg-deco {
            position: absolute;
            z-index: 0;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
        }
        .bg-deco-1 { top: 10%; left: -20px; color: #FCD34D; font-size: 4rem; animation-delay: 0s; }
        .bg-deco-2 { bottom: 15%; right: -20px; color: #F59E0B; font-size: 5rem; animation-delay: 2s; }
        .bg-deco-3 { top: 40%; right: 10%; color: #FDE68A; font-size: 2rem; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        /* --- Card Stack Styles --- */
        .card-view-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
            height: 100%;
            padding: 20px 0;
            z-index: 10;
        }

        .card-stack {
            position: relative;
            width: 85vw; /* Responsive width */
            max-width: 360px;
            /* Use aspect ratio or calc for height to prevent overflow */
            height: 65vh; 
            max-height: 580px;
            perspective: 1000px;
            margin-bottom: 20px;
        }

        .memory-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(120, 53, 15, 0.15);
            padding: 12px 12px 60px 12px;
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1.2), opacity 0.5s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border: 1px solid #FFF7ED;
            transform-origin: 50% 100%; /* Pivot from bottom for nicer stacking */
        }

        .memory-card-inner {
            width: 100%;
            height: 100%;
            background-color: #FEF3C7;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
        }

        .memory-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        /* Fly Out Animations */
        .fly-out-right {
            transform: translate(120vw, 50px) rotate(25deg) !important;
            opacity: 0;
        }
        .fly-out-left {
            transform: translate(-120vw, 50px) rotate(-25deg) !important;
            opacity: 0;
        }

        /* --- Scrollable Content (Hidden Initially) --- */
        .hidden-content {
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in;
        }
        
        .fade-in-content {
            display: block;
            animation: fadeInUp 1s forwards;
        }

        /* Button Styles */
        .btn-glow {
            background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
        }
        .btn-glow:active { transform: scale(0.96); box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3); }

        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 0.5s ease-in-out;
        }
        .hidden-page { pointer-events: none; opacity: 0; z-index: -1; }
        .active-page { opacity: 1; z-index: 10; pointer-events: auto; }

    </style>
</head>
<body>

<div class="app-container">

    <!-- Decorative BG Elements -->
    <i class="fas fa-heart bg-deco bg-deco-1"></i>
    <i class="fas fa-star bg-deco bg-deco-2"></i>
    <i class="fas fa-circle bg-deco bg-deco-3"></i>

    <!-- ================= PAGE 1: Landing ================= -->
    <section id="page-1" class="page active-page flex flex-col items-center justify-center p-8 text-center">
        
        <div class="animate__animated animate__bounceInDown">
            <div class="relative inline-block mb-6">
                <i class="fas fa-heart text-8xl text-yellow-400 drop-shadow-md"></i>
                <i class="fas fa-smile-wink text-4xl text-white absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i>
            </div>
            
            <h1 class="text-6xl font-extrabold mb-2 text-yellow-600 drop-shadow-sm tracking-tight">ปะป๊า เดย์</h1>
            <p class="text-xl text-yellow-800 font-light tracking-widest mb-10 uppercase">Happy Father's Day</p>
        </div>

        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-xl border-2 border-yellow-100 mb-12 w-full max-w-xs transform -rotate-1 animate__animated animate__fadeInUp animate__delay-1s">
            <p class="text-lg text-gray-700 leading-relaxed font-normal">
                "ขอบคุณป๊าสำหรับทุกอย่างนะ" ❤️<br>
                <span class="text-sm text-gray-500 mt-3 block">เว็บนี้รวมความทรงจำดีๆ ของเราไว้</span>
            </p>
        </div>

        <button onclick="goToPage2()" class="btn-glow py-4 px-10 rounded-full text-xl font-bold flex items-center gap-3 animate__animated animate__pulse animate__infinite">
            <span>เปิดกล่องความทรงจำ</span>
            <i class="fas fa-chevron-right text-sm"></i>
        </button>
    </section>

    <!-- ================= PAGE 2: Memory Cards & Messages ================= -->
    <section id="page-2" class="page hidden-page flex flex-col relative">
        
        <!-- Header Button -->
        <div class="absolute top-4 right-4 z-50">
            <button onclick="location.reload()" class="bg-white/90 backdrop-blur shadow-md text-yellow-600 w-10 h-10 rounded-full flex items-center justify-center hover:bg-yellow-50 transition-colors">
                <i class="fas fa-home"></i>
            </button>
        </div>

        <!-- Main Scroll Area -->
        <div id="main-scroll" class="flex-1 overflow-y-auto overflow-x-hidden no-scrollbar w-full h-full relative scroll-smooth">
            
            <!-- SECTION A: CARD STACK (Full Screen Center) -->
            <div id="card-section" class="card-view-area min-h-[100dvh]"> <!-- Ensure it takes full height initially -->
                
                <div class="text-center mb-6 animate__animated animate__fadeInDown">
                    <h2 class="text-2xl font-bold text-yellow-800">ความทรงจำกับป๊า</h2>
                    <p class="text-yellow-600 text-sm opacity-80 mt-1">
                        <i class="fas fa-hand-pointer animate-bounce"></i> จิ้มรูปเพื่อดูใบถัดไป
                    </p>
                </div>

                <div class="card-stack" id="cardStack">
                    <!-- JS Injects Cards Here -->
                    <div class="flex items-center justify-center h-full text-yellow-300">
                        <i class="fas fa-circle-notch fa-spin text-4xl"></i>
                    </div>
                </div>

                <!-- End Message (Hidden Initially) -->
                <div id="end-message" class="hidden text-center p-8 animate__animated animate__zoomIn">
                    <div class="inline-block bg-yellow-100 p-4 rounded-full mb-4">
                        <i class="fas fa-gift text-5xl text-yellow-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-yellow-800 mb-2">ดูครบแล้ว!</h3>
                    <p class="text-gray-600 mb-6">รักป๊านะ❤️</p>
                    <button onclick="renderCards()" class="text-yellow-600 underline text-sm hover:text-yellow-800">
                        ดูรูปอีกรอบ
                    </button>
                </div>
            </div>

            <!-- SECTION B: MESSAGES & FORM (Hidden until cards finished) -->
            <div id="after-cards-content" class="hidden-content pb-10">
                
                <!-- Message List -->
                <div class="px-6 py-8 bg-white/60 backdrop-blur-sm rounded-t-[40px] shadow-[0_-10px_40px_rgba(0,0,0,0.03)] -mt-8 relative z-20">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-white shadow-sm">
                            <i class="fas fa-comment-dots"></i>
                        </div>
                        <h3 class="text-xl font-bold text-yellow-900">ข้อความจากลูกๆ</h3>
                    </div>

                    <div id="message-list" class="space-y-4 min-h-[200px]">
                        <div class="text-center text-gray-400 py-10 italic">กำลังโหลด...</div>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="p-6 bg-white shadow-lg relative z-30">
                    <div class="text-center mb-4">
                        <span class="bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full font-bold">ส่งความในใจถึงป๊า</span>
                    </div>
                    <form id="messageForm" class="flex flex-col gap-3">
                        <input type="text" id="senderName" placeholder="ชื่อคนส่ง" class="w-full bg-gray-50 border-0 rounded-xl px-4 py-3 text-gray-700 ring-1 ring-gray-200 focus:ring-2 focus:ring-yellow-400 focus:bg-white transition-all outline-none" required>
                        <textarea id="messageText" placeholder="เขียนข้อความอวยพร..." rows="3" class="w-full bg-gray-50 border-0 rounded-xl px-4 py-3 text-gray-700 ring-1 ring-gray-200 focus:ring-2 focus:ring-yellow-400 focus:bg-white transition-all outline-none resize-none" required></textarea>
                        
                        <button type="submit" class="btn-glow w-full py-3.5 rounded-xl font-bold text-lg mt-2 flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i> ส่งข้อความ
                        </button>
                    </form>
                </div>

            </div> <!-- End after-cards-content -->

        </div>
    </section>

</div>

<!-- Firebase Logic -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
    import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBbKPZNIohm6ui5XCKAoDtBmvBF0qHpPU0",
        authDomain: "dadday-3f408.firebaseapp.com",
        databaseURL: "https://dadday-3f408-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "dadday-3f408",
        storageBucket: "dadday-3f408.firebasestorage.app",
        messagingSenderId: "295636170978",
        appId: "1:295636170978:web:46d1a89933e89ef90406bb",
        measurementId: "G-KE2YEKJXLH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, 'messages');
    const messageList = document.getElementById('message-list');

    onValue(query(messagesRef, limitToLast(50)), (snapshot) => {
        messageList.innerHTML = ''; 
        const data = snapshot.val();
        if (data) {
            const messages = Object.values(data);
            if (messages.length === 0) {
                messageList.innerHTML = '<div class="text-center text-gray-400 text-sm py-6">ยังไม่มีข้อความ มาส่งคนแรกกันเถอะ!</div>';
            } else {
                // Reverse to show newest first
                messages.reverse().forEach(msg => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bg-white border border-yellow-100 p-4 rounded-2xl shadow-sm hover:shadow-md transition-shadow animate__animated animate__fadeInUp';
                    bubble.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-yellow-100 flex items-center justify-center text-xs text-yellow-600 font-bold">
                                    ${msg.name.charAt(0).toUpperCase()}
                                </div>
                                <span class="font-bold text-yellow-900 text-sm">${escapeHtml(msg.name)}</span>
                            </div>
                            <span class="text-[10px] text-gray-400 bg-gray-50 px-2 py-1 rounded-full">${new Date(msg.timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                        <p class="text-gray-600 text-sm leading-relaxed pl-8">${escapeHtml(msg.text)}</p>
                    `;
                    messageList.appendChild(bubble);
                });
            }
        } else {
            messageList.innerHTML = '<div class="text-center text-gray-400 text-sm py-6">ยังไม่มีข้อความ มาส่งคนแรกกันเถอะ!</div>';
        }
    });

    document.getElementById('messageForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const nameInput = document.getElementById('senderName');
        const textInput = document.getElementById('messageText');
        const btn = e.target.querySelector('button');

        if(nameInput.value.trim() === '' || textInput.value.trim() === '') return;

        const originalBtnContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
        btn.disabled = true;

        push(messagesRef, {
            name: nameInput.value,
            text: textInput.value,
            timestamp: Date.now()
        }).then(() => {
            textInput.value = '';
            
            Swal.fire({
                icon: 'success',
                title: 'ส่งแล้ว!',
                text: 'ข้อความถึงป๊าเรียบร้อย',
                timer: 2000,
                showConfirmButton: false,
                confirmButtonColor: '#F59E0B'
            });

            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
        }).catch((error) => {
            console.error("Error", error);
            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
        });
    });

    function escapeHtml(text) {
        if (!text) return "";
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }
</script>

<!-- UI Logic -->
<script>
    function goToPage2() {
        const p1 = document.getElementById('page-1');
        const p2 = document.getElementById('page-2');
        
        p1.classList.remove('active-page');
        p1.classList.add('hidden-page');
        
        p2.classList.remove('hidden-page');
        p2.classList.add('active-page');
        
        renderCards(); 
    }

    const totalCards = 12;
    const cardStack = document.getElementById('cardStack');
    const endMessage = document.getElementById('end-message');
    const afterCardsContent = document.getElementById('after-cards-content');
    const mainScroll = document.getElementById('main-scroll');
    const cardSection = document.getElementById('card-section');
    let cardsArray = [];

    // Fallback image handler
    window.handleImageError = function(img, index) {
        img.onerror = null;
        img.src = `https://placehold.co/400x600/FEF3C7/78350F?text=รูปที่+${index}%0A(ไม่พบไฟล์)`;
        img.parentElement.style.backgroundColor = "#FEF3C7";
    };

    function renderCards() {
        // Reset State
        cardStack.style.display = 'block';
        endMessage.classList.add('hidden');
        
        // Hide content again if resetting
        afterCardsContent.classList.remove('fade-in-content');
        afterCardsContent.classList.add('hidden-content');
        
        // Reset scroll layout
        cardSection.style.minHeight = '100dvh'; 

        cardStack.innerHTML = '';
        cardsArray = [];

        for (let i = 1; i <= totalCards; i++) {
            const card = document.createElement('div');
            card.className = 'memory-card';
            
            // Stack logic
            const zIndex = totalCards - i; 
            // Less rotation for cleaner look
            const randomRot = (Math.random() * 4) - 2; 
            
            // REMOVED SCALE LOGIC as requested
            // const scale = 1 - (i * 0.03); 
            const translateY = i * 4; 

            card.style.zIndex = zIndex;
            // Removed scale() from transform
            card.style.transform = `rotate(${randomRot}deg) translateY(${translateY}px)`;
            
            const imgPath = `img/dad-${i}.jpg`;
            
            card.innerHTML = `
                <div class="memory-card-inner shadow-inner">
                    <img src="${imgPath}" 
                         alt="Memory ${i}" 
                         draggable="false" 
                         onerror="handleImageError(this, ${i})">
                </div>
                <div class="mt-4 flex justify-between items-center w-full px-2">
                    <i class="fas fa-quote-left text-yellow-300 text-lg"></i>
                    <span class="font-handwriting text-yellow-800 font-bold tracking-widest text-sm opacity-60">#Memory ${i}</span>
                </div>
            `;
            card.addEventListener('click', () => handleCardClick(card));
            cardStack.appendChild(card);
            cardsArray.push(card);
        }
    }

    function handleCardClick(card) {
        const direction = Math.random() > 0.5 ? 'fly-out-right' : 'fly-out-left';
        card.classList.add(direction);
        
        setTimeout(() => {
            card.style.display = 'none';
            checkIfEmpty();
        }, 500);
    }

    function checkIfEmpty() {
        const remaining = cardsArray.filter(c => c.style.display !== 'none');
        
        if (remaining.length === 0) {
            // 1. Hide Stack
            cardStack.style.display = 'none';
            
            // 2. Show tiny end message
            endMessage.classList.remove('hidden');

            // 3. Reveal Content (Messages + Form)
            afterCardsContent.classList.remove('hidden-content');
            afterCardsContent.classList.add('fade-in-content');

            // 4. Smooth Scroll down to content
            // Allow section to shrink so content flows naturally
            cardSection.style.minHeight = 'auto'; 
            
            setTimeout(() => {
                afterCardsContent.scrollIntoView({ behavior: 'smooth' });
            }, 300);
        }
    }
</script>

</body>
</html>
