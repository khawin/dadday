<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏õ‡∏∞‡∏õ‡πä‡∏≤</title>
    
    <!-- Google Fonts: Kanit -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (for styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SweetAlert2 (for beautiful alerts) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #FEF9C3; /* Yellow-100 tone */
            color: #713F12; /* Brown tone text */
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* Container for Mobile View */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background-color: #FFFBEB; /* Lighter yellow */
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating-element {
            animation: float 3s ease-in-out infinite;
        }

        /* Card Stack Styles */
        .card-stack {
            position: relative;
            width: 300px;
            height: 420px;
            margin: 20px auto;
            perspective: 1000px;
        }

        .memory-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            padding: 10px 10px 40px 10px; /* Polaroid style */
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #FDE68A;
        }

        .memory-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            pointer-events: none;
        }

        /* Animation class for flying away */
        .fly-out-right {
            transform: translate(120%, 20deg) rotate(30deg) !important;
            opacity: 0;
        }
        
        .fly-out-left {
            transform: translate(-120%, -20deg) rotate(-30deg) !important;
            opacity: 0;
        }

        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .page {
            transition: opacity 0.5s ease;
        }
        
        .hidden-page {
            display: none;
            opacity: 0;
        }

        /* Message Bubble */
        .message-bubble {
            background-color: #FEF3C7;
            border-left: 4px solid #F59E0B;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            position: relative;
        }
    </style>
</head>
<body>

<div class="app-container relative">

    <!-- Page 1: Landing Page -->
    <section id="page-1" class="page flex flex-col items-center justify-center h-screen p-6 text-center">
        <div class="floating-element mb-8">
            <i class="fas fa-heart text-6xl text-yellow-500 drop-shadow-lg"></i>
        </div>
        
        <h1 class="text-5xl font-bold mb-4 text-yellow-600 drop-shadow-sm">‡∏õ‡∏∞‡∏õ‡πä‡∏≤ ‡πÄ‡∏î‡∏¢‡πå</h1>
        <h2 class="text-xl text-yellow-800 mb-8 font-light">Happy Father's Day</h2>

        <div class="bg-white/60 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-yellow-200 mb-10 w-full">
            <p class="text-lg text-gray-700 leading-relaxed">
                ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏õ‡πä‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏∞ ‚ù§Ô∏è<br>
                ‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏î‡∏µ‡πÜ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏ß‡πâ<br>
                <span class="text-sm text-gray-500 mt-2 block">(‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏∞ üëá)</span>
            </p>
        </div>

        <button onclick="goToPage2()" class="group relative bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-4 px-10 rounded-full shadow-lg transition-all transform hover:scale-105 active:scale-95">
            <span class="mr-2 text-xl">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥</span>
            <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
            <span class="absolute -top-1 -right-1 flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-200 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-white"></span>
            </span>
        </button>
    </section>

    <!-- Page 2: Main Content -->
    <section id="page-2" class="page hidden-page flex flex-col h-screen overflow-hidden">
        
        <!-- Header -->
        <header class="bg-yellow-400 text-white p-4 shadow-md z-10 flex justify-between items-center rounded-b-2xl">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-yellow-500 font-bold text-xl">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">‡∏õ‡∏∞‡∏õ‡πä‡∏≤ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h1>
                    <p class="text-xs text-yellow-100">‡∏£‡∏ß‡∏°‡∏£‡∏π‡∏õ‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà</p>
                </div>
            </div>
            <button onclick="location.reload()" class="text-white hover:text-yellow-100">
                <i class="fas fa-home"></i>
            </button>
        </header>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto no-scrollbar pb-24" id="scroll-container">
            
            <!-- 1. Card Stack Section -->
            <div class="mt-6 mb-2 text-center">
                <span class="bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full border border-yellow-200">
                    <i class="fas fa-hand-pointer mr-1"></i> ‡∏à‡∏¥‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏õ‡∏•‡∏¥‡∏ß‡πÑ‡∏õ
                </span>
            </div>

            <div class="card-stack" id="cardStack">
                <!-- Cards will be injected here by JS -->
                <div class="flex items-center justify-center h-full text-yellow-300">
                    <i class="fas fa-circle-notch fa-spin text-4xl"></i>
                </div>
            </div>

            <!-- End Card Message (Hidden initially) -->
            <div id="end-card-msg" class="hidden text-center p-8 bg-white mx-4 rounded-xl shadow-sm border border-yellow-200 mt-4">
                <i class="fas fa-images text-4xl text-yellow-300 mb-2"></i>
                <p class="text-yellow-800">‡∏î‡∏π‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏±‡∏Å‡∏õ‡πä‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞</p>
                <button onclick="renderCards()" class="mt-2 text-yellow-600 underline text-sm">‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö</button>
            </div>

            <!-- 2. Message List Section -->
            <div class="px-4 mt-8">
                <h3 class="text-xl font-bold text-yellow-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-comments text-yellow-500"></i>
                    ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏õ‡πä‡∏≤
                </h3>
                
                <div id="message-list" class="space-y-3 min-h-[100px]">
                    <!-- Messages from Firebase will appear here -->
                    <div class="text-center text-gray-400 py-4 text-sm italic" id="loading-msg">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Fixed Bottom Form -->
        <div class="bg-white p-4 border-t border-yellow-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20">
            <form id="messageForm" class="flex flex-col gap-2">
                <div class="flex gap-2">
                    <input type="text" id="senderName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á" class="w-1/3 bg-yellow-50 border border-yellow-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    <input type="text" id="messageText" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏õ‡πä‡∏≤..." class="flex-1 bg-yellow-50 border border-yellow-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                </div>
                <button type="submit" class="w-full bg-yellow-400 text-white font-bold py-2 rounded-lg hover:bg-yellow-500 active:scale-95 transition-all shadow-md flex items-center justify-center gap-2">
                    <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏õ‡πä‡∏≤
                </button>
            </form>
        </div>

    </section>

</div>

<!-- Firebase Logic -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
    import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBbKPZNIohm6ui5XCKAoDtBmvBF0qHpPU0",
        authDomain: "dadday-3f408.firebaseapp.com",
        databaseURL: "https://dadday-3f408-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "dadday-3f408",
        storageBucket: "dadday-3f408.firebasestorage.app",
        messagingSenderId: "295636170978",
        appId: "1:295636170978:web:46d1a89933e89ef90406bb",
        measurementId: "G-KE2YEKJXLH"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // --- Message Logic ---
    const messagesRef = ref(db, 'messages');
    const messageList = document.getElementById('message-list');
    const loadingMsg = document.getElementById('loading-msg');

    // Listen for messages
    onValue(query(messagesRef, limitToLast(50)), (snapshot) => {
        messageList.innerHTML = ''; // Clear list
        const data = snapshot.val();
        
        if (data) {
            // Convert object to array and reverse (newest first for standard display, 
            // but prompt implied "messages come before form", usually oldest to newest or newest to oldest. 
            // Let's do newest at bottom like a chat, or newest at top.
            // Let's do a simple list: Object.values(data)
            
            const messages = Object.values(data);
            
            if (messages.length === 0) {
                messageList.innerHTML = '<div class="text-center text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏°‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</div>';
            } else {
                messages.forEach(msg => {
                    const bubble = document.createElement('div');
                    bubble.className = 'message-bubble animate__animated animate__fadeInUp';
                    bubble.innerHTML = `
                        <div class="flex justify-between items-baseline mb-1">
                            <span class="font-bold text-yellow-800 text-sm">${escapeHtml(msg.name)}</span>
                            <span class="text-xs text-yellow-600 opacity-60">${new Date(msg.timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                        <p class="text-gray-700 text-sm">${escapeHtml(msg.text)}</p>
                    `;
                    // Prepend to show newest at top, or Append for chat log style. 
                    // Let's Prepend so user sees new stuff immediately without scrolling too much
                    messageList.prepend(bubble);
                });
            }
        } else {
            messageList.innerHTML = '<div class="text-center text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏°‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</div>';
        }
    });

    // Send Message
    document.getElementById('messageForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const nameInput = document.getElementById('senderName');
        const textInput = document.getElementById('messageText');
        const btn = e.target.querySelector('button');

        if(nameInput.value.trim() === '' || textInput.value.trim() === '') return;

        // Visual feedback
        const originalBtnContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
        btn.disabled = true;

        push(messagesRef, {
            name: nameInput.value,
            text: textInput.value,
            timestamp: Date.now()
        }).then(() => {
            textInput.value = ''; // Clear text, keep name
            
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß!',
                text: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏õ‡πä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö',
                timer: 1500,
                showConfirmButton: false,
                confirmButtonColor: '#FBBF24'
            });

            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
            
            // Auto scroll to latest if needed (depends on prepend/append logic)
            // document.getElementById('scroll-container').scrollTop = 0; 
        }).catch((error) => {
            console.error("Error writing new message to Firebase Database", error);
            Swal.fire({
                icon: 'error',
                title: '‡∏≠‡∏∏‡πä‡∏ö‡∏™‡πå',
                text: '‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞',
                confirmButtonColor: '#FBBF24'
            });
            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
        });
    });

    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>

<!-- UI Logic (Non-Module) -->
<script>
    // --- Navigation ---
    function goToPage2() {
        const p1 = document.getElementById('page-1');
        const p2 = document.getElementById('page-2');
        
        p1.style.opacity = '0';
        setTimeout(() => {
            p1.style.display = 'none';
            p2.classList.remove('hidden-page');
            // Trigger reflow
            void p2.offsetWidth; 
            p2.style.opacity = '1';
            
            renderCards(); // Init cards
        }, 500);
    }

    // --- Card Logic ---
    const totalCards = 12;
    const cardStack = document.getElementById('cardStack');
    let cardsArray = [];

    function renderCards() {
        cardStack.innerHTML = '';
        document.getElementById('end-card-msg').classList.add('hidden');
        cardsArray = [];

        for (let i = 1; i <= totalCards; i++) {
            const card = document.createElement('div');
            card.className = 'memory-card';
            
            // Z-index: First card (1) on top, Last card (12) at bottom
            // Actually, usually 1 is top. Let's make index 1 have highest z-index
            const zIndex = totalCards - i; 
            
            // Random slight rotation for messy stack look
            const randomRot = (Math.random() * 6) - 3; // -3 to 3 deg
            
            card.style.zIndex = zIndex;
            card.style.transform = `rotate(${randomRot}deg) scale(${1 - (i*0.02)}) translateY(${i*2}px)`;
            
            // Image Content
            // Using onerror to show placeholder if image is missing
            card.innerHTML = `
                <div class="w-full h-full bg-gray-100 rounded-lg overflow-hidden relative shadow-inner">
                    <img src="img/dad-${i}.jpg" alt="Memory ${i}" draggable="false" 
                         onerror="this.src='https://placehold.co/300x400/FFF9C4/713F12?text=‡∏£‡∏π‡∏õ‡∏õ‡πä‡∏≤+${i}'; this.style.objectFit='contain';">
                </div>
                <div class="mt-3 font-handwriting text-yellow-800 font-bold text-sm w-full text-right">
                    #Memory ${i}
                </div>
            `;

            // Add Click Event
            card.addEventListener('click', () => handleCardClick(card));
            
            cardStack.appendChild(card);
            cardsArray.push(card);
        }
    }

    function handleCardClick(card) {
        // Only allow clicking the top card
        // We can check if it has the highest z-index currently visible
        // Or simpler: Disable pointer events on all cards except top one?
        // Let's just animate it away.
        
        // Direction: Random Left or Right
        const direction = Math.random() > 0.5 ? 'fly-out-right' : 'fly-out-left';
        
        card.classList.add(direction);
        
        // Remove from DOM after animation to prevent clicking again
        setTimeout(() => {
            card.style.display = 'none';
            checkIfEmpty();
        }, 500);
    }

    function checkIfEmpty() {
        const remaining = cardsArray.filter(c => c.style.display !== 'none');
        if (remaining.length === 0) {
            document.getElementById('end-card-msg').classList.remove('hidden');
            // Confetti effect could go here
            fireConfetti();
        }
    }

    function fireConfetti() {
        Swal.fire({
            title: '‡∏£‡∏±‡∏Å‡∏õ‡πä‡∏≤‡∏ô‡∏∞!',
            text: '‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡∏õ‡πä‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞',
            imageUrl: 'https://cdn-icons-png.flaticon.com/512/2919/2919927.png',
            imageWidth: 100,
            imageHeight: 100,
            confirmButtonText: '‡πÇ‡∏≠‡πÄ‡∏Ñ‡∏à‡πâ‡∏≤',
            confirmButtonColor: '#FBBF24',
            backdrop: `
                rgba(255,249,196,0.4)
                url("https://media.giphy.com/media/uCTpCqV9q8bLO/giphy.gif")
                left top
                no-repeat
            `
        });
    }

    // Adjust height for mobile browsers header bar
    window.addEventListener('resize', () => {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    });
</script>

</body>
</html>
